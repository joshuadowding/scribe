<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Scribe</title>

    <link type="text/css" rel="stylesheet" href="../css/index.css">
  </head>
  <body>
    <div class="editor-wrapper">
      <div class="editor-column" id="editor-meta">
      </div>
      <div class="editor-handle"></div>
      <div class="editor-column" id="editor-main">
      </div>
    </div>

    <!-- Fix: https://github.com/electron/electron/issues/345 -->
    <script type="text/javascript" src="../lib/jquery-3.5.1.min.js" onload="window.$ = window.jQuery = module.exports;"></script>

    <script type="text/javascript">
      const ipc = require('electron').ipcRenderer;
      const theme = require('../js/renderer/theme');

      $(document).ready(() => {
        // Detect the system theme preference on start-up:
        let currentTheme = theme.detectTheme();
        theme.chooseTheme(currentTheme);
        ipc.send('current-theme', currentTheme); // Report the detected theme preference on-startup.

        // Allow the user to resize the editor-column elements:
        let handler = document.querySelector('.editor-handle');
        let wrapper = handler.closest('.editor-wrapper');
        let box = wrapper.querySelector('.editor-column');
        let isHandlerDragging = false;

        $(document).mousedown((event) => {
          if (event.target === handler) { isHandlerDragging = true; }
        });

        $(document).mousemove((event) => {
          if (!isHandlerDragging) { return false; }

          let pointerRelativeX = event.clientX - wrapper.offsetLeft;
          box.style.width = (Math.max(256, pointerRelativeX - 16)) + 'px';
          box.style.flexGrow = 0;
        });

        $(document).mouseup(() => { isHandlerDragging = false; });
        $(document).mouseleave(() => { isHandlerDragging = false; });
      });

      ipc.on('toggle-theme', () => {
        ipc.send('current-theme', theme.toggleTheme());
      });

      ipc.on('detect-theme', () => {
        let currentTheme = theme.detectTheme();
        theme.chooseTheme(currentTheme);
        ipc.send('current-theme', currentTheme);
      });
    </script>
  </body>
</html>
