<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">

    <link type="text/css" rel="stylesheet" href="../css/index.css">
    <link type="text/css" rel="stylesheet" href="../lib/fonts/inter/inter.css">
    <link type="text/css" rel="stylesheet" href="../lib/fonts/remix/remixicon.css">
  </head>
  <body>
    <div class="editor-wrapper">
      <div class="editor-column" id="editor-meta">
        <div class="editor-toolbar">
          <div class="dropdown-wrapper">
            <button class="button toolbar-button" id="editor-add" type="button"><i class='ri-add-line'></i></button>

            <div class="dropdown toolbar-dropdown" id="add-dropdown">
              <button class="button dropdown-button" id="add-file" type="button"><i class='ri-add-line'></i> Document</button>
              <button class="button dropdown-button" id="add-folder" type="button"><i class='ri-add-line'></i> Folder</button>
            </div>
          </div>

          <button class="button toolbar-button" id="editor-remove" type="button"><i class="ri-subtract-line"></i></button>
        </div>
        <div class="editor-items" id="item-list">

        </div>
      </div>
      <div class="editor-handle"></div>
      <div class="editor-column" id="editor-main">
        <div class="editor-toolbar">

        </div>
      </div>
    </div>

    <script type="text/javascript" src="../lib/jquery-3.5.1.min.js" onload="window.$ = window.jQuery = module.exports;"></script>

    <script type="text/javascript">
      const ipc = require('electron').ipcRenderer;
      const theme = require('../js/helpers/theme');

      $(document).ready(function() {
        // Detect the system theme preference on start-up:
        let currentTheme = theme.detectTheme();
        theme.chooseTheme(currentTheme);
        ipc.send('current-theme', currentTheme); // Report the detected theme preference on-startup.

        // Allow the user to resize the editor-column elements:
        let handler = document.querySelector('.editor-handle');
        let wrapper = handler.closest('.editor-wrapper');
        let box = wrapper.querySelector('.editor-column');
        let isHandlerDragging = false;

        $(document).mousedown((event) => {
          if (event.target === handler) { isHandlerDragging = true; }
        });

        $(document).mousemove((event) => {
          if (!isHandlerDragging) { return false; }

          let pointerRelativeX = event.clientX - wrapper.offsetLeft;
          box.style.width = (Math.max(256, pointerRelativeX - 16)) + 'px';
          box.style.flexGrow = 0;
        });

        $(document).mouseup(() => { isHandlerDragging = false; });
        $(document).mouseleave(() => { isHandlerDragging = false; });

        $('#editor-add').click(function() {
          if ($('#add-dropdown').hasClass('show')) {
            $('#add-dropdown').removeClass('show');
          } else {
            $('#add-dropdown').addClass('show');
          }
        });

        $('#add-file').click(function() {
          // TODO: Support selecting items in the hierarchy to create sub-items.
          ipc.send('create-file');
          $('#add-dropdown').removeClass('show');
        });

        $('#add-folder').click(function() {
          // TODO: Support selecting items in the hierarchy to create sub-items.
          ipc.send('create-folder');
          $('#add-dropdown').removeClass('show');
        });

        $('.editor-items').on('click', '.item', function() {
          $(this).parent().each(() => { $('.item').removeClass('selected'); });

          if ($(this).hasClass('selected')) { $(this).removeClass('selected'); }
          else { $(this).addClass('selected'); }
        });
      });

      ipc.on('toggle-theme', () => {
        ipc.send('current-theme', theme.toggleTheme());
      });

      ipc.on('detect-theme', () => {
        let currentTheme = theme.detectTheme();
        theme.chooseTheme(currentTheme);
        ipc.send('current-theme', currentTheme);
      });

      ipc.on('update-project', (error, data) => {
        $('#item-list').empty(); // Empty the item-list before we re-populate it.

        for (let i = 0; i < data.length; i++) {
          let element = document.createElement('div');
          $(element).addClass('item');

          let content = document.createTextNode(data[i]);
          element.appendChild(content);

          let parent = document.getElementById('item-list');
          parent.appendChild(element);
        }
      });
    </script>
  </body>
</html>
