<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Scribe</title>

    <link type="text/css" rel="stylesheet" href="../css/index.css">
  </head>
  <body>
    <div class="editor-wrapper">
      <div class="editor-column" id="editor-meta">
      </div>
      <div class="handler"></div>
      <div class="editor-column" id="editor-main">
      </div>
    </div>

    <!-- Fix: https://github.com/electron/electron/issues/345 -->
    <script type="text/javascript" src="../lib/jquery-3.5.1.min.js" onload="window.$ = window.jQuery = module.exports;"></script>

    <script type="text/javascript">
      const ipc = require('electron').ipcRenderer;
      const theme = require('../js/renderer/theme');

      // Detect the system theme preference on-startup:
      $(document).ready(function() {
        let currentTheme = theme.detectTheme();
        theme.chooseTheme(currentTheme);
        ipc.send('current-theme', currentTheme); // Report the detected theme preference on-startup.

        // Reference: https://stackoverflow.com/questions/46931103/making-a-dragbar-to-resize-divs-inside-css-grids/46934825
        let handler = document.querySelector('.handler');
        let wrapper = handler.closest('.editor-wrapper');
        let box = wrapper.querySelector('.editor-column');
        let isHandlerDragging = false;

        document.addEventListener('mousedown', function(event) {
          if (event.target === handler) {
            isHandlerDragging = true;
          }
        });

        document.addEventListener('mousemove', function(event) {
          if (!isHandlerDragging) {
            return false;
          }

          let containerOffsetLeft = wrapper.offsetLeft;
          let pointerRelativeXpos = event.clientX - containerOffsetLeft;
          let boxMinWidth = 256;

          box.style.width = (Math.max(boxMinWidth, pointerRelativeXpos - 8)) + 'px';
          box.style.flexGrow = 0;
        });

        document.addEventListener('mouseup', function() {
          isHandlerDragging = false;
        });

        document.addEventListener('mouseleave', function() {
          isHandlerDragging = false;
        });
      });

      ipc.on('toggle-theme', () => {
        ipc.send('current-theme', theme.toggleTheme());
      });

      ipc.on('detect-theme', () => {
        let currentTheme = theme.detectTheme();
        theme.chooseTheme(currentTheme);
        ipc.send('current-theme', currentTheme);
      });
    </script>
  </body>
</html>
